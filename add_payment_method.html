<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter un moyen de paiement</title>
</head>
<body>

<h2>Ajouter un moyen de paiement</h2>

<form id="paymentForm">
    <label>UID utilisateur :</label>
    <input type="text" id="uid" placeholder="UID Firebase" required><br><br>

    <label>Surnom (nickname) :</label>
    <input type="text" id="nickname" placeholder="Ex: Mon MTN" required><br><br>

    <label>Opérateur :</label>
    <select id="operator" required>
        <option value="">Choisir...</option>
        <option>MTN Bénin</option>
        <option>Moov Bénin</option>
        <option>Celtiis</option>
        <option>Moov Togo</option>
        <option>Mixx By Yas</option>
        <option>MTN Côte d'Ivoire</option>
        <option>Airtel Niger</option>
        <option>Free Senegal</option>
    </select><br><br>

    <label>Prénom :</label>
    <input type="text" id="firstName" required><br><br>

    <label>Nom :</label>
    <input type="text" id="lastName" required><br><br>

    <label>Numéro Mobile Money :</label>
    <input type="text" id="phone" placeholder="Sans indicatif" required><br><br>

    <button type="submit">Ajouter</button>
</form>


<p id="response" style="margin-top:20px; font-weight:bold;"></p>


<script>
document.getElementById("paymentForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const payload = {
        uid: document.getElementById("uid").value.trim(),
        nickname: document.getElementById("nickname").value.trim(),
        operator: document.getElementById("operator").value.trim(),
        firstName: document.getElementById("firstName").value.trim(),
        lastName: document.getElementById("lastName").value.trim(),
        phone: document.getElementById("phone").value.trim(),
    };

    document.getElementById("response").innerText = "Envoi...";

    const res = await fetch("/.netlify/functions/add_payment_method", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const data = await res.json();

    document.getElementById("response").innerText =
        data.success ? "✔️ Méthode enregistrée !" : "❌ " + data.error;
});
</script>

</body>
</html>